#+OPTIONS: toc:nil
#+HTML_HEAD: <link href="../css/solarized-dark.css" rel="stylesheet" />
#+HTML_LINK_HOME: ../index.html
#+TITLE: Weather Forecast

#+begin_html
City:<br>
<input type="text" name="city" id="city-query"></input><br><br>
Country:<br>
<input type="text" name="state" id="country-query"></input><br><br>
<input type="radio" name="units" value="imperial" id="units-query" checked="checked">Imperial</input>
<input type="radio" name="units" value="metric">Metric</input><br><br>
<input type="submit" value="Get 5 Day Forecast" id="get-weather"></input>
<br><br>
<div id="weather-output"></div>
#+end_html

Here's the script. The apiKey is no longer valid, it seems.
#+BEGIN_SRC javascript -n
var elTrigger;
elTrigger = document.getElementById('get-weather');
elTrigger.addEventListener('click', function() {
    var script = document.createElement('script');
    var city = document.getElementById('city-query').value;
    var country = document.getElementById('country-query').value;
    var query = "q=" + city + "," + country;
    var apiKey = "8a024bce3364f0ae98bd83c9c3d5fcdd";
    var units = "&units=";
    if (document.getElementById("units-query").checked) {
        units += 'imperial';
    } else {
        units += 'metric';
    }
    var url = "http://api.openweathermap.org/data/2.5/forecast?" + query +
              "&callback=showWeather&" + units + "&appid=" + apiKey;
    script.setAttribute('src', url);
    document.getElementById('scripts').appendChild(script);
}, false);

function showWeather(data) {
    var position = document.getElementById('weather-output');
    position.innerHTML = '';  // clear prior table, if exists
    var title = document.createElement('h3');
    var titleContent = document.createTextNode(data.city.name + ", " +
                                               data.city.country + " (" +
                                               data.city.coord.lon + "\xb0" +
                                               ", " + data.city.coord.lat +
                                               "\xb0)");
    title.appendChild(titleContent);
    position.appendChild(title);
    var table = document.createElement('table');
    var units;
    if (document.getElementById("units-query").checked) {
        units = " (mph)";
    } else {
        units = " (m/s)";
    }
    var headers = ["Date",
                   "Time",
                   "Low",
                   "High",
                   "Condition",
                   "Wind Speed" + units,
                   "Humidity"];
    var row = document.createElement('tr');
    for (var i = 0; i < headers.length; i++) {
        var header = document.createElement('th');
        var headerContent = document.createTextNode(headers[i]);
        header.appendChild(headerContent);
        row.appendChild(header);
    }
    table.appendChild(row);
    for (var i = 0; i < data.cnt; i++) {
        var row = document.createElement('tr');
        var columns = [data.list[i].dt_txt.slice(0,10),
                       data.list[i].dt_txt.slice(10,16),
                       data.list[i].main.temp_min+'\xb0',
                       data.list[i].main.temp_max+'\xb0',
                       data.list[i].weather[0].description,
                       data.list[i].wind.speed,
                       data.list[i].main.humidity+'%'];
        for (var j = 0; j < columns.length; j++) {
            var cell = document.createElement('td');
            var cellContent = document.createTextNode(columns[j]);
            cell.appendChild(cellContent);
            row.appendChild(cell);
        }
        table.appendChild(row);
    }
    position.appendChild(table);
}
#+END_SRC

#+begin_html
<script src="../js/weather.js"></script>
#+end_html
